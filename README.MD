## 项目概述

本项目旨在针对小e社游戏CG与立绘的解包信息，解析lsf文件并合成cg或立绘图片。以下是项目的详细说明：

### 文件结构与功能模块

1. **`lsfInfo.py`**
   - 提供了两个类用于解析lsf文件信息。
   - **文件格式**：
     - lsf文件有固定长度的文件头，包含信息块数量与立绘或cg图片大小。
     - 每个信息块长度固定，头部若干字节为图片名字（ASCII编码），第128字节到第143字节包含图片的左上右下坐标信息，每四字节保存一个坐标信息。
     - 第152、153、154字节分别保存图片类型、图片ID等信息，第155字节固定为0xff，其余字节值恒为0x00。
   - **关键信息提取**：
     - 图片名字、图片的左上界坐标（即合成cg时的横纵偏移量）、图片类型和图片ID。
     - 部分图片的第154字节为0x03，表示白底且有透明底版本，优先使用透明底版本进行合成。
     - 图片类型在cg中分为底片（0）、人物表情差分（10、20、30等）、人脸脸红特效差分（11、21、31等）和圣光（0xff）；在立绘中分为底片（0、3）、人物表情差分（1）、脸红特效差分（2）。
     - 相同ID的底片图片可能有多张，需组合成完整的底片。

2. **`synthesis_util.py`**
   - 提供函数用于合成图片，使用OpenCV库完成。
   - 流程：创建空白图像，根据信息块获取图片路径读取，按照偏移量粘贴到空白图像上，最终合成完整cg。

3. **`synthesis_script.py`**
   - 提供脚本批量合成图片，支持组合人脸表情差分与动作重复（无脸红差分与圣光），并将结果输出。
   - 使用前需将解包文件放入对应目录。

4. **`synthesisGUI.py`**
   - 提供GUI工具，用户可手动选择差分合成cg并输出。

### 注意事项

- 项目初始基于ev.bin解包得到的'0'目录中的cg组件图片进行分析，在工作基本完成后才考虑兼容其他cg包与立绘包（cg包有两个，立绘包有三个，图片大小不一样）。因此，`LSFFile`中添加了许多补丁代码，部分if判断可能是后期添加的。
- 已知bug：
  - EV_B05中，男主的牛牛差分类型标注为人脸，导致部分cg男主同时出现在两个地方。
  - EV_G05中，女主由于被拍照，cg中同一个人有两张脸。当前解决方案是放弃手机中显示的人脸。
- 工具已在废村少女中测试，除上述两点外无明显bug，理论上可用于其他小e社的游戏，但尚未进行测试，未来会更新以支持更多游戏。

### 总结

本项目通过解析lsf文件并合成cg或立绘图片，提供了命令行脚本和GUI工具，方便用户操作。尽管存在一些已知问题，但在特定游戏中表现良好。欢迎社区贡献改进方案，共同完善工具。